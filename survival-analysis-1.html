<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Survival Analysis | Coding Challenge: a Survival Analysis on Simulated Cancer Data</title>
  <meta name="description" content="5 Survival Analysis | Coding Challenge: a Survival Analysis on Simulated Cancer Data" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Survival Analysis | Coding Challenge: a Survival Analysis on Simulated Cancer Data" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Survival Analysis | Coding Challenge: a Survival Analysis on Simulated Cancer Data" />
  
  
  

<meta name="author" content="Danny Scarponi" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-imputation-1.html"/>

<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script language="javascript"> 
    function toggle(id) {
        var ele = document.getElementById("toggleText" + id);
        var text = document.getElementById("displayText" + id);
        var buttonText = text.innerHTML.replace("Show: ", "");
        buttonText = buttonText.replace("Hide: ", "");
        if(ele.style.display == "block") {
            ele.style.display = "none";
            text.innerHTML = "Show: " + buttonText;
        } else {
            ele.style.display = "block";
            text.innerHTML = "Hide: " + buttonText;
        }
    } 
</script>

<script language="javascript">
    function openCode(evt, codeName, id) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent" + id);
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("tablinks" + id);
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(codeName).style.display = "block";
        evt.currentTarget.className += " active";
    }
</script>

<script language="javascript">
    function hide(id){
        document.getElementById(id).style.display = "none";
    }
</script>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">



<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Summary</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#data-preparation"><i class="fa fa-check"></i><b>1.1</b> Data Preparation</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#cohort-description"><i class="fa fa-check"></i><b>1.2</b> Cohort Description</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#data-imputation"><i class="fa fa-check"></i><b>1.3</b> Data Imputation</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#survival-analysis"><i class="fa fa-check"></i><b>1.4</b> Survival Analysis</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-preparation-1.html"><a href="data-preparation-1.html"><i class="fa fa-check"></i><b>2</b> Data Preparation</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-preparation-1.html"><a href="data-preparation-1.html#medication-variable"><i class="fa fa-check"></i><b>2.1</b> Medication Variable</a></li>
<li class="chapter" data-level="2.2" data-path="data-preparation-1.html"><a href="data-preparation-1.html#dates-variables"><i class="fa fa-check"></i><b>2.2</b> Dates Variables</a></li>
<li class="chapter" data-level="2.3" data-path="data-preparation-1.html"><a href="data-preparation-1.html#demographic-variables"><i class="fa fa-check"></i><b>2.3</b> Demographic Variables</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="cohort-description-1.html"><a href="cohort-description-1.html"><i class="fa fa-check"></i><b>3</b> Cohort Description</a></li>
<li class="chapter" data-level="4" data-path="data-imputation-1.html"><a href="data-imputation-1.html"><i class="fa fa-check"></i><b>4</b> Data Imputation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="data-imputation-1.html"><a href="data-imputation-1.html#multiple-imputation"><i class="fa fa-check"></i><b>4.1</b> Multiple Imputation</a></li>
<li class="chapter" data-level="4.2" data-path="data-imputation-1.html"><a href="data-imputation-1.html#checking-imputed-data"><i class="fa fa-check"></i><b>4.2</b> Checking Imputed Data</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="survival-analysis-1.html"><a href="survival-analysis-1.html"><i class="fa fa-check"></i><b>5</b> Survival Analysis</a>
<ul>
<li class="chapter" data-level="5.1" data-path="survival-analysis-1.html"><a href="survival-analysis-1.html#univariate-analysis"><i class="fa fa-check"></i><b>5.1</b> Univariate Analysis</a></li>
<li class="chapter" data-level="5.2" data-path="survival-analysis-1.html"><a href="survival-analysis-1.html#cox-multiple-regression"><i class="fa fa-check"></i><b>5.2</b> Cox Multiple Regression</a></li>
<li class="chapter" data-level="5.3" data-path="survival-analysis-1.html"><a href="survival-analysis-1.html#verifying-assumptions"><i class="fa fa-check"></i><b>5.3</b> Verifying Assumptions</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="survival-analysis-1.html"><a href="survival-analysis-1.html#proportional-hazards"><i class="fa fa-check"></i><b>5.3.1</b> Proportional Hazards</a></li>
<li class="chapter" data-level="5.3.2" data-path="survival-analysis-1.html"><a href="survival-analysis-1.html#linearity"><i class="fa fa-check"></i><b>5.3.2</b> Linearity</a></li>
<li class="chapter" data-level="5.3.3" data-path="survival-analysis-1.html"><a href="survival-analysis-1.html#influential-observations"><i class="fa fa-check"></i><b>5.3.3</b> Influential Observations</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="survival-analysis-1.html"><a href="survival-analysis-1.html#sensitivity-analysis"><i class="fa fa-check"></i><b>5.4</b> Sensitivity Analysis</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Coding Challenge: a Survival Analysis on Simulated Cancer Data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="survival-analysis-1" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Survival Analysis</h1>
<div id="univariate-analysis" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Univariate Analysis</h2>
<p>Let us start by estimating the survival curve in the two treatment groups for the first imputed dataset:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="survival-analysis-1.html#cb74-1" aria-hidden="true" tabindex="-1"></a>imputed_1 <span class="ot">&lt;-</span> <span class="fu">complete</span>(imputed_data,<span class="dv">1</span>)</span>
<span id="cb74-2"><a href="survival-analysis-1.html#cb74-2" aria-hidden="true" tabindex="-1"></a>surv_fit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(fu, event)<span class="sc">~</span>medication, <span class="at">data =</span> imputed_1)</span>
<span id="cb74-3"><a href="survival-analysis-1.html#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(surv_fit, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">120</span>), <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;red&quot;</span>,<span class="st">&quot;blue&quot;</span>), <span class="at">lty=</span><span class="dv">1</span>, <span class="at">lwd=</span><span class="dv">2</span>, </span>
<span id="cb74-4"><a href="survival-analysis-1.html#cb74-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;Weeks&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Survival&quot;</span>)</span>
<span id="cb74-5"><a href="survival-analysis-1.html#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="at">x =</span> <span class="st">&quot;topright&quot;</span>,          <span class="co"># Position</span></span>
<span id="cb74-6"><a href="survival-analysis-1.html#cb74-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Crizotinib&quot;</span>, <span class="st">&quot;Entrectinib&quot;</span>),  <span class="co"># Legend texts</span></span>
<span id="cb74-7"><a href="survival-analysis-1.html#cb74-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),           <span class="co"># Line types</span></span>
<span id="cb74-8"><a href="survival-analysis-1.html#cb74-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>),           <span class="co"># Line colors</span></span>
<span id="cb74-9"><a href="survival-analysis-1.html#cb74-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="dv">2</span>)  </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-33-1.png" style="display: block; margin: auto;" /></p>
<p>The two curves do not seem substantially different. Let’s now run a Log-rank test to check whether the difference in the two estimated curves is statistically significant:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="survival-analysis-1.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(fu, event)<span class="sc">~</span>medication, <span class="at">data =</span> imputed_1)</span></code></pre></div>
<pre><code>## Call:
## survdiff(formula = Surv(fu, event) ~ medication, data = imputed_1)
## 
##                          N Observed Expected (O-E)^2/E (O-E)^2/V
## medication=crizotinib  231      151      142     0.533      1.04
## medication=entrectinib 232      142      151     0.503      1.04
## 
##  Chisq= 1  on 1 degrees of freedom, p= 0.3</code></pre>
<p>The test suggests that there is not enough evidence to reject the null hypothesis that the two survival curves are not different. Of course, this is a univariate analysis, which does not account for differences in all other covariates between the two treatment groups, and in this analysis we only looked at the first imputed dataset. To account for all covariates and all imputed datasets we fit a Cox Multiple Regression model to each imputed dataset and then pool the statistics obtained.</p>
</div>
<div id="cox-multiple-regression" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Cox Multiple Regression</h2>
<p>To assess whether the survival of patients differs in the two treatment groups, we fitted a Cox Regression model for each of the imputed datasets. Let us analyse the pooled statistics for the fitted Cox models:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="survival-analysis-1.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">pool</span>(models), <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##                    term     estimate   std.error   statistic       df
## 1                   age  0.007112186 0.006997901  1.01633138 282.1335
## 2                  sex1  0.001256594 0.120209962  0.01045333 282.5921
## 3              ph.ecog1  0.398998873 0.167500975  2.38206896 277.8997
## 4              ph.ecog2  0.922655472 0.255806244  3.60685282 261.1758
## 5              ph.ecog3  1.677028332 0.514363717  3.26039392 277.7397
## 6              ph.karno  0.019038762 0.008281139  2.29905114 275.9777
## 7               wt.loss -0.004262902 0.004726079 -0.90199554 247.0426
## 8 medicationentrectinib -0.128153604 0.118168728 -1.08449677 282.6867
##        p.value        2.5 %      97.5 %
## 1 0.3103423672 -0.006662537 0.020886910
## 2 0.9916669789 -0.235363988 0.237877176
## 3 0.0178886646  0.069266993 0.728730754
## 4 0.0003712572  0.418950326 1.426360618
## 5 0.0012512576  0.664481731 2.689574933
## 6 0.0222491550  0.002736536 0.035340987
## 7 0.3679378027 -0.013571448 0.005045645
## 8 0.2790686390 -0.360755899 0.104448691</code></pre>
<p>This suggests that the ECOG score is a statistically significant predictor, due to the rather small p-values (0.001 for ECOG score 3 compared to score 0). Higher ECOG scores correspond to higher hazard rates, with score 3 changing the hazard by a factor of <span class="math inline">\(5.35=\exp(1.677028332)\)</span> <span class="math inline">\([95\% \text{ CI } (1.94-14.73)]\)</span>, compared to score zero. This result is in accordance with our expectation.</p>
<p>The Karnofsky score also has a small p-value (below 0.05). Higher Karnofsky scores correspond to higher hazard rates, with an increase of one point in the Karnofsky score leading to an increase of <span class="math inline">\(2\%\)</span> <span class="math inline">\([95\% \text{ CI } (0.3\%-3.6\%)]\)</span> in the hazard. Since higher Karnofsky scores indicate better health conditions, this result is slightly counterintuitive and deserves further investigation.</p>
<p>Even tough the negative coefficient for Entrectinib with respect to Crizotinib is in accordance with our previous remark that the percentage of deaths is lower in patients treated with Entrectinib, <strong>the treatment (Crizotinib vs Entrectinib) was not a statistically significant predictor for the survival of patients (p-value <span class="math inline">\(0.28\)</span>)</strong>.</p>
<p>The p-values for all remaining covariates (age, sex, weight loss) also suggest that they are not statistically significant.</p>
</div>
<div id="verifying-assumptions" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> Verifying Assumptions</h2>
<div id="proportional-hazards" class="section level3" number="5.3.1">
<h3><span class="header-section-number">5.3.1</span> Proportional Hazards</h3>
<p>To check whether the assumption of proportional hazards is satisfied, we use the Schoenfeld residuals:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="survival-analysis-1.html#cb79-1" aria-hidden="true" tabindex="-1"></a>Schoen <span class="ot">&lt;-</span> <span class="fu">with</span>(imputed_data, </span>
<span id="cb79-2"><a href="survival-analysis-1.html#cb79-2" aria-hidden="true" tabindex="-1"></a>               <span class="fu">cox.zph</span>(<span class="fu">coxph</span>(<span class="fu">Surv</span>(fu, event) <span class="sc">~</span> age<span class="sc">+</span>sex<span class="sc">+</span>ph.ecog<span class="sc">+</span>ph.karno<span class="sc">+</span>wt.loss<span class="sc">+</span>medication)) )</span>
<span id="cb79-3"><a href="survival-analysis-1.html#cb79-3" aria-hidden="true" tabindex="-1"></a>p_value <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="dv">20</span>, <span class="dv">6</span>)</span>
<span id="cb79-4"><a href="survival-analysis-1.html#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>) {</span>
<span id="cb79-5"><a href="survival-analysis-1.html#cb79-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) </span>
<span id="cb79-6"><a href="survival-analysis-1.html#cb79-6" aria-hidden="true" tabindex="-1"></a>    p_value[i,j] <span class="ot">&lt;-</span> Schoen<span class="sc">$</span>analyses[[i]][[<span class="dv">1</span>]][j,<span class="dv">3</span>]</span>
<span id="cb79-7"><a href="survival-analysis-1.html#cb79-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb79-8"><a href="survival-analysis-1.html#cb79-8" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(p_value <span class="sc">&lt;</span><span class="fl">0.05</span>)</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<p>The element [i,j] in <code>p_value</code>, contains the p-value for the proportionality assumption for the jth predictor on the ith imputed dataset. We see that almost no element in <code>p-value</code> is below 0.05, suggesting that the proportionality assumption holds for all predictors.</p>
</div>
<div id="linearity" class="section level3" number="5.3.2">
<h3><span class="header-section-number">5.3.2</span> Linearity</h3>
<p>To check whether there is a roughly linear relationship between the log-hazard and the continuous covariates, we start by fitting a Cox model without the continuous covariates. We use the first imputed dataset for this analysis:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="survival-analysis-1.html#cb81-1" aria-hidden="true" tabindex="-1"></a>cox_categ <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(fu, event) <span class="sc">~</span> sex<span class="sc">+</span>ph.ecog<span class="sc">+</span>medication, <span class="at">data =</span> imputed_1)</span></code></pre></div>
<p>We then plot the Martingale residuals of such model against the three continuous covariates:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="survival-analysis-1.html#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(imputed_1<span class="sc">$</span>age, <span class="fu">residuals</span>(cox_categ), <span class="at">xlab =</span> <span class="st">&quot;age&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Martingale residuals&quot;</span>)</span>
<span id="cb82-2"><a href="survival-analysis-1.html#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(imputed_1<span class="sc">$</span>age, <span class="fu">residuals</span>(cox_categ)), <span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-38-1.png" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="survival-analysis-1.html#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(imputed_1<span class="sc">$</span>ph.karno, <span class="fu">residuals</span>(cox_categ), <span class="at">xlab =</span> <span class="st">&quot;ph.karno&quot;</span> , <span class="at">ylab =</span> <span class="st">&quot;Martingale residuals&quot;</span>)</span>
<span id="cb83-2"><a href="survival-analysis-1.html#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(imputed_1<span class="sc">$</span>ph.karno, <span class="fu">residuals</span>(cox_categ)), <span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-38-2.png" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="survival-analysis-1.html#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(imputed_1<span class="sc">$</span>wt.loss, <span class="fu">residuals</span>(cox_categ), <span class="at">xlab =</span> <span class="st">&quot;weight loss&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Martingale residuals&quot;</span>)</span>
<span id="cb84-2"><a href="survival-analysis-1.html#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(imputed_1<span class="sc">$</span>wt.loss, <span class="fu">residuals</span>(cox_categ)), <span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-38-3.png" style="display: block; margin: auto;" /></p>
<p>The lowess lines are relatively straight. This, and the fact that the same is true for all other imputed datasets, suggest that the linearity assumption is satisfied.</p>
</div>
<div id="influential-observations" class="section level3" number="5.3.3">
<h3><span class="header-section-number">5.3.3</span> Influential Observations</h3>
<p>To search for possible outliers, we plot the deviance residuals using the <code>ggcoxdiagnostics</code> function:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="survival-analysis-1.html#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcoxdiagnostics</span>(<span class="fu">coxph</span>(<span class="fu">Surv</span>(fu, event) <span class="sc">~</span> age<span class="sc">+</span>sex<span class="sc">+</span>ph.ecog<span class="sc">+</span>ph.karno<span class="sc">+</span>wt.loss<span class="sc">+</span>medication, </span>
<span id="cb85-2"><a href="survival-analysis-1.html#cb85-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> imputed_1), <span class="at">type =</span> <span class="st">&quot;deviance&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: `gather_()` was deprecated in tidyr 1.2.0.
## i Please use `gather()` instead.
## i The deprecated feature was likely used in the survminer package.
##   Please report the issue at &lt;https://github.com/kassambara/survminer/issues&gt;.</code></pre>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-39-1.png" style="display: block; margin: auto;" /></p>
<p>The plot suggests that the residuals for the first imputed dataset are roughly symmetrically distributed around zero and most of them fall within the range <span class="math inline">\([-2,2]\)</span>. It is easy to check that the same is true for the residuals of all other imputed datasets. We can therefore assume that none of the observations is terribly influential individually.</p>
</div>
</div>
<div id="sensitivity-analysis" class="section level2" number="5.4">
<h2><span class="header-section-number">5.4</span> Sensitivity Analysis</h2>
<p>Since we imputed missing variables, it is useful to compare the results of our main analysis with the results we obtain by fitting a Cox Regression model only using the complete observations.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="survival-analysis-1.html#cb88-1" aria-hidden="true" tabindex="-1"></a>merged_inc <span class="ot">&lt;-</span> <span class="fu">merge</span>(demographics, medications, <span class="at">by=</span><span class="st">&quot;id&quot;</span>)</span>
<span id="cb88-2"><a href="survival-analysis-1.html#cb88-2" aria-hidden="true" tabindex="-1"></a>merged_inc <span class="ot">&lt;-</span> <span class="fu">merge</span>(merged_inc, dates, <span class="at">by =</span> <span class="st">&quot;id&quot;</span>)</span>
<span id="cb88-3"><a href="survival-analysis-1.html#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(merged_inc)[<span class="dv">7</span>] <span class="ot">&lt;-</span> <span class="st">&quot;medication&quot;</span></span>
<span id="cb88-4"><a href="survival-analysis-1.html#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(merged_inc)[<span class="dv">8</span>] <span class="ot">&lt;-</span> <span class="st">&quot;first_diag&quot;</span></span>
<span id="cb88-5"><a href="survival-analysis-1.html#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(merged_inc)[<span class="dv">9</span>] <span class="ot">&lt;-</span> <span class="st">&quot;death&quot;</span></span>
<span id="cb88-6"><a href="survival-analysis-1.html#cb88-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(merged_inc)[<span class="dv">10</span>] <span class="ot">&lt;-</span> <span class="st">&quot;end&quot;</span></span>
<span id="cb88-7"><a href="survival-analysis-1.html#cb88-7" aria-hidden="true" tabindex="-1"></a>merged_inc<span class="sc">$</span>medication[merged_inc<span class="sc">$</span>medication<span class="sc">==</span><span class="st">&quot;crizotinab&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Crizotinib&quot;</span> </span>
<span id="cb88-8"><a href="survival-analysis-1.html#cb88-8" aria-hidden="true" tabindex="-1"></a>merged_inc<span class="sc">$</span>medication[merged_inc<span class="sc">$</span>medication<span class="sc">==</span><span class="st">&quot;Entrectinib&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Entrectinib&quot;</span> </span>
<span id="cb88-9"><a href="survival-analysis-1.html#cb88-9" aria-hidden="true" tabindex="-1"></a>merged_inc <span class="ot">&lt;-</span> merged_inc <span class="sc">%&gt;%</span> <span class="fu">filter</span>(end <span class="sc">==</span> <span class="st">&quot;&quot;</span> <span class="sc">|</span> death <span class="sc">==</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb88-10"><a href="survival-analysis-1.html#cb88-10" aria-hidden="true" tabindex="-1"></a>merged_inc <span class="ot">&lt;-</span> merged_inc <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">event =</span> <span class="fu">ifelse</span>(death <span class="sc">!=</span> <span class="st">&quot;&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb88-11"><a href="survival-analysis-1.html#cb88-11" aria-hidden="true" tabindex="-1"></a>merged_inc<span class="sc">$</span>fu[merged_inc<span class="sc">$</span>event<span class="sc">==</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">with</span>(merged_inc, <span class="fu">difftime</span>(death[event<span class="sc">==</span><span class="dv">1</span>], </span>
<span id="cb88-12"><a href="survival-analysis-1.html#cb88-12" aria-hidden="true" tabindex="-1"></a>                                                    first_diag[event<span class="sc">==</span><span class="dv">1</span>], <span class="at">units =</span> <span class="st">&quot;weeks&quot;</span>))</span>
<span id="cb88-13"><a href="survival-analysis-1.html#cb88-13" aria-hidden="true" tabindex="-1"></a>merged_inc<span class="sc">$</span>fu[merged_inc<span class="sc">$</span>event<span class="sc">==</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="fu">with</span>(merged_inc, <span class="fu">difftime</span>(end[event<span class="sc">==</span><span class="dv">0</span>],</span>
<span id="cb88-14"><a href="survival-analysis-1.html#cb88-14" aria-hidden="true" tabindex="-1"></a>                                                    first_diag[event<span class="sc">==</span><span class="dv">0</span>], <span class="at">units =</span> <span class="st">&quot;weeks&quot;</span>))</span>
<span id="cb88-15"><a href="survival-analysis-1.html#cb88-15" aria-hidden="true" tabindex="-1"></a>merged_inc <span class="ot">&lt;-</span> <span class="fu">select</span>(merged_inc, <span class="sc">-</span><span class="fu">c</span>(first_diag, end, death))</span>
<span id="cb88-16"><a href="survival-analysis-1.html#cb88-16" aria-hidden="true" tabindex="-1"></a>merged_inc <span class="ot">&lt;-</span> <span class="fu">filter</span>(merged_inc, fu <span class="sc">&gt;</span><span class="dv">0</span>)</span>
<span id="cb88-17"><a href="survival-analysis-1.html#cb88-17" aria-hidden="true" tabindex="-1"></a>merged_inc <span class="ot">&lt;-</span> <span class="fu">filter</span>(merged_inc, <span class="sc">!</span>(<span class="fu">is.na</span>(wt.loss) <span class="sc">|</span> <span class="fu">is.na</span>(ph.karno) <span class="sc">|</span> <span class="fu">is.na</span>(ph.ecog)))</span>
<span id="cb88-18"><a href="survival-analysis-1.html#cb88-18" aria-hidden="true" tabindex="-1"></a>merged_inc<span class="sc">$</span>sex <span class="ot">=</span> <span class="fu">as.factor</span>(merged_inc<span class="sc">$</span>sex)</span>
<span id="cb88-19"><a href="survival-analysis-1.html#cb88-19" aria-hidden="true" tabindex="-1"></a>merged_inc<span class="sc">$</span>ph.ecog <span class="ot">=</span> <span class="fu">as.factor</span>(merged_inc<span class="sc">$</span>ph.ecog)</span>
<span id="cb88-20"><a href="survival-analysis-1.html#cb88-20" aria-hidden="true" tabindex="-1"></a>merged_inc<span class="sc">$</span>medication <span class="ot">=</span> <span class="fu">as.factor</span>(merged_inc<span class="sc">$</span>medication)</span>
<span id="cb88-21"><a href="survival-analysis-1.html#cb88-21" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(fu, event) <span class="sc">~</span> age<span class="sc">+</span>sex<span class="sc">+</span>ph.ecog<span class="sc">+</span>ph.karno<span class="sc">+</span>wt.loss<span class="sc">+</span>medication, <span class="at">data =</span> merged_inc)</span></code></pre></div>
<pre><code>## Call:
## coxph(formula = Surv(fu, event) ~ age + sex + ph.ecog + ph.karno + 
##     wt.loss + medication, data = merged_inc)
## 
##                            coef exp(coef)  se(coef)      z        p
## age                    0.006569  1.006591  0.007388  0.889   0.3740
## sex1                  -0.040050  0.960741  0.127322 -0.315   0.7531
## ph.ecog1               0.441058  1.554351  0.178693  2.468   0.0136
## ph.ecog2               1.045063  2.843579  0.263616  3.964 7.36e-05
## ph.ecog3               1.340776  3.822007  0.577542  2.322   0.0203
## ph.karno               0.016018  1.016147  0.008770  1.826   0.0678
## wt.loss               -0.004172  0.995837  0.004802 -0.869   0.3850
## medicationCrizotinib   0.533680  1.705195  0.288295  1.851   0.0641
## medicationentrectinib -0.142374  0.867296  0.135750 -1.049   0.2943
## medicationEntrectinib -0.048936  0.952242  0.218375 -0.224   0.8227
## 
## Likelihood ratio test=24.81  on 10 df, p=0.00571
## n= 425, number of events= 267</code></pre>
<p>These results are in agreement with what found in our main analysis: the only covariates having p-value below 0.05 are the ECOG and the Karnofsky scores.</p>

<div id="refs" class="references csl-bib-body hanging-indent">
<div class="csl-entry">
Von Hippel, Paul T. 2020. <span>“How Many Imputations Do You Need? A Two-Stage Calculation Using a Quadratic Rule.”</span> <em>Sociological Methods &amp; Research</em> 49 (3): 699–718.
</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-imputation-1.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
